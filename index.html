<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chatbot Octavio</title>
  <style>
    /* Animation keyframes */
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(ellipse at center, #111 0%, #0c0c0c 100%);
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: fadeIn 2s ease-in-out;
    }

    h1 {
      color: #00ffc8;
      font-weight: bold;
      text-shadow: 0 0 15px #00ffc8;
      animation: fadeIn 2s ease-in-out;
      margin-bottom: 20px;
    }

    #chatbox {
      width: 100%;
      max-width: 600px;
      height: 400px;
      background: rgba(26, 26, 26, 0.6);
      backdrop-filter: blur(10px);
      overflow-y: auto;
      border-radius: 16px;
      padding: 10px;
      margin-bottom: 15px;
      box-shadow: 0 0 25px rgba(0, 255, 200, 0.3);
      animation: slideUp 1s ease-out;
      scrollbar-width: thin;
      scrollbar-color: #00ffc8 #111;
    }

    .message {
      margin: 10px 0;
      padding: 12px 18px;
      border-radius: 12px;
      max-width: 75%;
      display: inline-block;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .message:hover {
      transform: scale(1.02);
      box-shadow: 0 0 20px rgba(0, 255, 200, 0.2);
    }

    .user {
      background: rgba(0, 191, 255, 0.2);
      color: #00bfff;
      align-self: flex-end;
      text-align: right;
    }

    .bot {
      background: rgba(0, 255, 148, 0.15);
      color: #00ff94;
      align-self: flex-start;
    }

    .message::before {
      margin-right: 8px;
    }

    .user::before {
      content: 'üôã';
    }

    .bot::before {
      content: 'ü§ñ';
    }

    #inputForm {
      display: flex;
      max-width: 600px;
      width: 100%;
      margin-top: 10px;
    }

    #inputQuestion {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 8px 0 0 8px;
      background: #222;
      color: #eee;
      outline: none;
    }

    button {
      padding: 12px;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #submitBtn {
      background: #00ffc8;
      color: #111;
      border-radius: 0 8px 8px 0;
    }

    #submitBtn:hover {
      background: #00bfa5;
    }

    #historyBtn, #clearHistoryBtn {
      margin-top: 10px;
      width: 100%;
      max-width: 600px;
      border-radius: 8px;
      font-weight: bold;
    }

    #historyBtn {
      background: #00ffc8;
      color: #111;
    }

    #historyBtn:hover {
      background: #00bfa5;
    }

    #clearHistoryBtn {
      background: #ff4d4d;
      color: #fff;
    }

    #clearHistoryBtn:hover {
      background: #cc0000;
    }
  </style>
</head>
<body>
  <h1>ùë≤ùë®ùë≤ùë®ùë∫ùëØùë∞ ùë®ùë∞ üíª</h1>
  <div id="chatbox"></div>
  <form id="inputForm">
    <input type="text" id="inputQuestion" placeholder="Pose ta question..." required />
    <button type="submit" id="submitBtn">Envoyer</button>
  </form>
  <button id="historyBtn">Voir l'historique</button>

  <script>
    const chatbox = document.getElementById('chatbox');
    const form = document.getElementById('inputForm');
    const input = document.getElementById('inputQuestion');
    const historyBtn = document.getElementById('historyBtn');

    function addMessage(text, sender) {
      const div = document.createElement('div');
      div.className = 'message ' + sender;
      div.textContent = (sender === 'user' ? 'Vous : ' : 'Kakashi bot : ') + text;
      chatbox.appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function saveQuestion(question) {
      const history = JSON.parse(localStorage.getItem('dav_history') || '[]');
      history.push(question);
      localStorage.setItem('dav_history', JSON.stringify(history));
    }

    function isAboutCreator(text) {
      const t = text.toLowerCase();
      return (
        t.includes("qui t'a cr√©√©") ||
        t.includes("je ete cree par octavio") ||
        t.includes("qui es-tu") ||
        t.includes("tu es qui") ||
        t.includes("octavio")
      );
    }

    async function askGemini(prompt) {
      const apiKey = 'API_KEY_ICI'; // ‚ö†Ô∏è √Ä s√©curiser c√¥t√© serveur
      const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
      const body = { contents: [{ parts: [{ text: prompt }] }] };
      try {
        const res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        const data = await res.json();
        return data.candidates?.[0]?.content?.parts?.[0]?.text || "Je n'ai pas compris.";
      } catch (err) {
        return "Une erreur s'est produite.";
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const question = input.value.trim();
      if (!question) return;

      addMessage(question, 'user');
      saveQuestion(question);
      input.value = '';

      let reply = "Je r√©fl√©chis...";
      addMessage(reply, 'bot');

      if (isAboutCreator(question)) {
        reply = "Bonjour ! Je suis ùë≤ùë®ùë≤ùë®ùë∫ùëØùë∞ AI, une intelligence artificielle cr√©√©e par Octavio Wina üòá.";
      } else {
        reply = await askGemini(question);
      }

      chatbox.lastChild.remove(); // retire "Je r√©fl√©chis..."
      addMessage(reply, 'bot');
    });

    historyBtn.onclick = () => {
      const history = JSON.parse(localStorage.getItem('dav_history') || '[]');
      if (history.length === 0) {
        alert("Aucune question pos√©e.");
      } else {
        alert("Historique :\n" + history.join("\n"));
      }
    };
  </script>
</body>
</html>
